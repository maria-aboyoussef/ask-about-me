<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اجتماع بابا وماما - كنيسة المرقسية</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        :root {
            --primary: #2c6e49;
            --secondary: #4c956c;
            --accent: #fefee3;
            --light: #d8f3dc;
            --dark: #1b4332;
            --gray: #555;
            --white: #fff;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --error: #e74c3c;
            --warning: #f39c12;
            --delete: #e74c3c;
            --whatsapp: #25D366;
            --call: #3498db;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px;
            text-align: center;
        }
        
        .login-box {
            background: var(--white);
            border-radius: 15px;
            padding: 40px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 500px;
            position: relative;
        }
        
        .app-logo {
            width: 120px;
            height: 120px;
            background: var(--light);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            color: var(--primary);
            border: 5px solid var(--accent);
        }
        
        h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .app-description {
            color: var(--gray);
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .input-group {
            margin-bottom: 25px;
            text-align: right;
            position: relative;
        }
        
        .error-message {
            color: var(--error);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        textarea {
            height: 120px;
            resize: vertical;
        }
        
        input.error, select.error {
            border-color: var(--error);
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(44, 110, 73, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .instructions {
            background: var(--accent);
            border-left: 5px solid var(--primary);
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 30px 0;
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-right: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning);
        }
        
        .alert i {
            font-size: 24px;
        }
        
        .help-box {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px dashed var(--primary);
        }
        
        .help-box h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .welcome-message {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .import-container {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px dashed var(--primary);
        }
        
        .action-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background: var(--light);
            color: var(--dark);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-width: 120px;
        }
        
        .action-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
        }
        
        .action-btn.call {
            background: rgba(52, 152, 219, 0.2);
            color: var(--call);
        }
        
        .action-btn.call:hover {
            background: var(--call);
            color: white;
        }
        
        .action-btn.whatsapp {
            background: rgba(37, 211, 102, 0.2);
            color: var(--whatsapp);
        }
        
        .action-btn.whatsapp:hover {
            background: var(--whatsapp);
            color: white;
        }
        
        .action-btn.delete {
            background: #f8d7da;
            color: var(--delete);
            border: 1px solid var(--delete);
        }
        
        .action-btn.delete:hover {
            background: var(--delete);
            color: white;
        }
        
        .action-btn.edit {
            background: rgba(243, 156, 18, 0.2);
            color: #e67e22;
        }
        
        .action-btn.edit:hover {
            background: #e67e22;
            color: white;
        }
        
        @media (max-width: 768px) {
            .login-box {
                padding: 30px 20px;
            }
            
            .report-filters {
                flex-direction: column;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .reset-btn {
            background: var(--error);
            margin-top: 15px;
        }
        
        .reset-btn:hover {
            background: #c0392b;
        }
        
        .delete-btn {
            background: var(--delete);
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        #deleteConfirmation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .confirmation-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .confirmation-box h2 {
            color: var(--delete);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .confirmation-buttons button {
            flex: 1;
        }
        
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .member-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            position: relative;
        }
        
        .member-card:hover {
            transform: translateY(-5px);
        }
        
        .member-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .member-icon {
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
        }
        
        .member-name {
            font-size: 20px;
            font-weight: 700;
        }
        
        .member-type {
            font-size: 14px;
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: 20px;
            margin-top: 5px;
        }
        
        .member-body {
            padding: 20px;
        }
        
        .member-info {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .member-info i {
            color: var(--primary);
            font-size: 18px;
            min-width: 24px;
            margin-top: 3px;
        }
        
        .member-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 90;
            transition: all 0.3s;
        }
        
        .add-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin: 30px 0;
        }
        
        .empty-state i {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border-bottom: 4px solid var(--primary);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 16px;
            color: var(--gray);
        }
        
        .navbar {
            background: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .active-page {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            background: var(--light);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        .report-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .report-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .report-title {
            color: var(--primary);
            font-size: 22px;
        }
        
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .summary-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .summary-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .chart-container {
            height: 300px;
            margin: 30px 0;
        }
        
        .report-table {
            margin: 30px 0;
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: var(--primary);
            color: white;
        }
        
        .data-table tr:hover {
            background: #f9f9f9;
        }
        
        .report-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .attendance-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }
        
        .attendance-card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input {
            width: 20px;
            height: 20px;
        }
        
        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }
        
        .attendance-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .attendance-date {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--light);
            padding: 10px 15px;
            border-radius: 10px;
        }
        
        .attendance-date input {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .export-btn {
            width: auto;
            padding: 12px 20px;
            background: var(--secondary);
        }
        
        .qrcode-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .notes-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid var(--primary);
        }
        
        .notes-container h4 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .servant-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border-left: 4px solid var(--call);
        }
        
        .servant-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .servant-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .activity-log {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--gray);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .admin-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <!-- شاشة الدخول -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="app-logo">
                <i class="fas fa-church"></i>
            </div>
            <h1>اجتماع بابا وماما</h1>
            <p class="app-description">تطبيق إدارة أعضاء مجموعة "بابا وماما" بكنيسة المرقسية لتسجيل الحضور والافتقاد والبيانات الشخصية</p>
            
            <div class="input-group">
                <label for="userType">نوع المستخدم</label>
                <select id="userType">
                    <option value="admin">المسؤول</option>
                    <option value="servant">الخادم</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="inviteCode" id="codeLabel">كود الدخول</label>
                <input type="password" id="inviteCode" placeholder="أدخل كود الدخول">
                <div class="error-message" id="codeError">كود الدخول غير صحيح. الرجاء المحاولة مرة أخرى.</div>
            </div>
            
            <div class="input-group" id="servantFields" style="display: none;">
                <label for="servantPhone">رقم الهاتف</label>
                <input type="tel" id="servantPhone" placeholder="رقم هاتف الخادم">
            </div>
            
            <button id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> دخول إلى التطبيق
            </button>
            
            <div class="help-box">
                <h3><i class="fas fa-question-circle"></i> مساعدة في الدخول</h3>
                <p>إذا كنت تواجه مشكلة في الدخول، جرب الحلول التالية:</p>
                <ul>
                    <li>تأكد من كتابة الكود بالأحرف الكبيرة: <strong>BABA123</strong> للمسؤول</li>
                    <li>الخدام يدخلون برقم الهاتف وكلمة المرور</li>
                    <li>إذا نسيت الكود، اتصل بالمسؤول لتغيير كلمة المرور</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- تأكيد الحذف -->
    <div id="deleteConfirmation">
        <div class="confirmation-box">
            <h2><i class="fas fa-exclamation-triangle"></i> تأكيد الحذف</h2>
            <p>هل أنت متأكد أنك تريد حذف هذا العضو؟</p>
            <p><strong id="memberToDelete">[اسم العضو]</strong></p>
            <p>هذا الإجراء لا يمكن التراجع عنه وسيتم حذف جميع بيانات العضو نهائيًا.</p>
            
            <div class="confirmation-buttons">
                <button id="confirmDeleteBtn" class="delete-btn">
                    <i class="fas fa-trash"></i> نعم، احذف العضو
                </button>
                <button id="cancelDeleteBtn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة تأكيد حذف الخادم -->
    <div id="deleteServantConfirmation" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-triangle"></i> تأكيد حذف الخادم</h2>
            <p>هل أنت متأكد أنك تريد حذف هذا الخادم؟</p>
            <p><strong id="servantToDelete">[اسم الخادم]</strong></p>
            <p>هذا الإجراء لا يمكن التراجع عنه وسيتم حذف جميع بيانات الخادم نهائياً.</p>
            
            <div class="confirmation-buttons">
                <button id="confirmServantDeleteBtn" class="delete-btn">
                    <i class="fas fa-trash"></i> نعم، احذف الخادم
                </button>
                <button id="cancelServantDeleteBtn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة إضافة/تعديل الخادم -->
    <div id="servantFormModal" class="modal">
        <div class="modal-content">
            <h2 id="servantFormTitle"><i class="fas fa-user-plus"></i> إضافة خادم جديد</h2>
            
            <div class="input-group">
                <label for="servantName">اسم الخادم</label>
                <input type="text" id="servantName" placeholder="اسم الخادم">
            </div>
            
            <div class="input-group">
                <label for="servantPhoneForm">رقم الهاتف</label>
                <input type="tel" id="servantPhoneForm" placeholder="رقم هاتف الخادم">
            </div>
            
            <div class="input-group">
                <label for="servantPassword">كلمة المرور</label>
                <input type="password" id="servantPassword" placeholder="كلمة مرور الخادم">
            </div>
            
            <div class="input-group">
                <label for="servantConfirmPassword">تأكيد كلمة المرور</label>
                <input type="password" id="servantConfirmPassword" placeholder="تأكيد كلمة المرور">
            </div>
            
            <div class="error-message" id="servantFormError"></div>
            
            <div class="confirmation-buttons">
                <button id="saveServantBtn">
                    <i class="fas fa-save"></i> حفظ
                </button>
                <button id="cancelServantBtn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة تغيير كلمة مرور المسؤول -->
    <div id="adminSettingsModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-lock"></i> تغيير كلمة مرور المسؤول</h2>
            
            <div class="input-group">
                <label for="currentPassword">كلمة المرور الحالية</label>
                <input type="password" id="currentPassword" placeholder="أدخل كلمة المرور الحالية">
            </div>
            
            <div class="input-group">
                <label for="newPassword">كلمة المرور الجديدة</label>
                <input type="password" id="newPassword" placeholder="أدخل كلمة المرور الجديدة">
            </div>
            
            <div class="input-group">
                <label for="confirmNewPassword">تأكيد كلمة المرور الجديدة</label>
                <input type="password" id="confirmNewPassword" placeholder="تأكيد كلمة المرور الجديدة">
            </div>
            
            <div class="error-message" id="adminSettingsError"></div>
            
            <div class="confirmation-buttons">
                <button id="saveAdminPasswordBtn">
                    <i class="fas fa-save"></i> حفظ
                </button>
                <button id="cancelAdminSettingsBtn">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>
    
    <!-- التطبيق الرئيسي (يظهر بعد الدخول) -->
    <div id="app" style="display: none;">
        <!-- شريط التنقل -->
        <nav class="navbar">
            <div class="container nav-container">
                <div class="app-title">
                    <i class="fas fa-church"></i>
                    <span>اجتماع بابا وماما - كنيسة المرقسية</span>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="homeBtn" title="الصفحة الرئيسية">
                        <i class="fas fa-home"></i>
                    </button>
                    <button class="nav-btn" id="membersBtn" title="قائمة الأعضاء">
                        <i class="fas fa-users"></i>
                    </button>
                    <button class="nav-btn" id="attendanceBtn" title="تسجيل الحضور">
                        <i class="fas fa-calendar-check"></i>
                    </button>
                    <button class="nav-btn" id="reportsBtn" title="التقارير">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="nav-btn" id="servantsBtn" title="إدارة الخدام" style="display: none;">
                        <i class="fas fa-user-friends"></i>
                    </button>
                    <button class="nav-btn" id="adminSettingsBtn" title="إعدادات المسؤول" style="display: none;">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="nav-btn" id="logoutBtn" title="تسجيل الخروج">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- المحتوى الرئيسي -->
        <div class="container app-content">
            <!-- الصفحة الرئيسية -->
            <div id="homePage" class="page active-page">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <strong>تم الدخول بنجاح!</strong>
                        <p>مرحبًا بك في تطبيق إدارة مجموعة بابا وماما</p>
                    </div>
                </div>
                
                <!-- رسالة الترحيب -->
                <div class="welcome-message" id="welcomeMessage">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <strong id="loggedInUser">مرحباً!</strong>
                        <p id="userRole">يتم تحميل معلومات المستخدم...</p>
                    </div>
                </div>
                
                <h2 class="section-title">
                    <i class="fas fa-home"></i>
                    الصفحة الرئيسية
                </h2>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> تعليمات استخدام التطبيق</h3>
                    <ul>
                        <li>استخدم قائمة التنقل أعلى الصفحة للوصول إلى الأقسام المختلفة</li>
                        <li>اضغط على زر (+) لإضافة عضو جديد</li>
                        <li>استخدم بطاقات الأعضاء للوصول السريع إلى بيانات العضو</li>
                        <li>استخدم أزرار التصدير لحفظ البيانات بصيغة PDF أو Excel</li>
                        <li>يمكنك تسجيل الحضور والافتقاد من الصفحات المخصصة</li>
                    </ul>
                </div>
                
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    إحصائيات التطبيق
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMembers">0</div>
                        <div class="stat-label">إجمالي الأعضاء</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="totalAttendance">0</div>
                        <div class="stat-label">حضور الاجتماع</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="totalVisits">0</div>
                        <div class="stat-label">زيارات الافتقاد</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="totalServants">0</div>
                        <div class="stat-label">عدد الخدام</div>
                    </div>
                </div>
                
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    آخر الأنشطة
                </h2>
                
                <table class="data-table" id="recentActivities">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>الخادم</th>
                            <th>النشاط</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>28/06/2025 10:30</td>
                            <td>بولا نادر</td>
                            <td>اتصال بماريان حنا</td>
                        </tr>
                        <tr>
                            <td>27/06/2025 15:45</td>
                            <td>مينا رامي</td>
                            <td>زيارة لبطرس سمير</td>
                        </tr>
                        <tr>
                            <td>26/06/2025 09:20</td>
                            <td>مريم عادل</td>
                            <td>رسالة لسميرة فوزي</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- صفحة الأعضاء -->
            <div id="membersPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    قائمة الأعضاء
                </h2>
                
                <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <input type="text" id="searchInput" placeholder="ابحث باسم العضو أو رقم الهاتف...">
                    </div>
                    <button id="sortMembersBtn" style="width: auto; padding: 0 20px;">
                        <i class="fas fa-sort-alpha-down"></i> ترتيب أبجدي
                    </button>
                </div>
                
                <div id="membersList" class="members-grid">
                    <!-- سيتم ملؤه ديناميكيًا -->
                </div>
                
                <div id="emptyMembers" class="empty-state" style="display: none;">
                    <i class="fas fa-user-slash"></i>
                    <h3>لا يوجد أعضاء مسجلين</h3>
                    <p>لم يتم إضافة أي أعضاء بعد. ابدأ بإضافة عضو جديد باستخدام الزر (+) في الأسفل.</p>
                    <button id="addFirstMember" style="width: auto; margin-top: 20px;">
                        <i class="fas fa-user-plus"></i> إضافة أول عضو
                    </button>
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn" id="importExcelBtn">
                        <i class="fas fa-file-import"></i> استيراد من Excel
                    </button>
                    <button class="export-btn">
                        <i class="fas fa-file-pdf"></i> تصدير إلى PDF
                    </button>
                    <button class="export-btn">
                        <i class="fas fa-file-excel"></i> تصدير إلى Excel
                    </button>
                </div>
            </div>
            
            <!-- صفحة إضافة عضو جديد -->
            <div id="addMemberPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-user-plus"></i>
                    تسجيل عضو جديد
                </h2>
                
                <div class="form-container">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="fullName">الاسم الكامل</label>
                            <input type="text" id="fullName" placeholder="الاسم الثلاثي">
                        </div>
                        
                        <div class="input-group">
                            <label for="memberType">النوع</label>
                            <select id="memberType">
                                <option value="بابا">بابا</option>
                                <option value="ماما">ماما</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="phone">رقم الهاتف</label>
                            <input type="tel" id="phone" placeholder="رقم الهاتف">
                        </div>
                        
                        <div class="input-group">
                            <label for="address">العنوان</label>
                            <input type="text" id="address" placeholder="العنوان بالتفصيل">
                        </div>
                        
                        <div class="input-group">
                            <label for="childrenCount">عدد الأطفال</label>
                            <input type="number" id="childrenCount" placeholder="عدد الأطفال">
                        </div>
                        
                        <div class="input-group">
                            <label for="childrenAges">أعمار الأطفال</label>
                            <input type="text" id="childrenAges" placeholder="أعمار الأطفال مفصولة بفواصل (مثال: 5,8,12)">
                        </div>
                        
                        <div class="input-group">
                            <label for="notes">ملاحظات خاصة</label>
                            <textarea id="notes" placeholder="ملاحظات خاصة بالعضو"></textarea>
                        </div>
                    </div>
                    
                    <div class="member-actions" style="margin-top: 20px;">
                        <button id="saveMemberBtn">
                            <i class="fas fa-save"></i> حفظ بيانات العضو
                        </button>
                        <button id="cancelAddMember" style="background: var(--gray);">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- صفحة تفاصيل العضو -->
            <div id="memberDetailsPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-user"></i>
                    تفاصيل العضو
                </h2>
                
                <div class="form-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div id="memberTitle">
                            <h2 style="color: var(--primary);">ماريان حنا <small style="font-size: 16px; background: var(--light); padding: 3px 10px; border-radius: 20px;">ماما</small></h2>
                        </div>
                        <button class="delete-btn" id="deleteMemberBtn" style="display: none;">
                            <i class="fas fa-trash"></i> حذف العضو
                        </button>
                    </div>
                    
                    <div id="memberDetailsContent">
                        <div class="member-info">
                            <i class="fas fa-phone"></i>
                            <span><strong>رقم الهاتف:</strong> 01234567890</span>
                        </div>
                        <div class="member-info">
                            <i class="fas fa-map-marker-alt"></i>
                            <span><strong>العنوان:</strong> 15 شارع الكنيسة، القاهرة</span>
                        </div>
                        <div class="member-info">
                            <i class="fas fa-child"></i>
                            <span><strong>الأطفال:</strong> 3 أطفال (5,8,12 سنة)</span>
                        </div>
                        
                        <div class="qrcode-container">
                            <div id="memberQrcode"></div>
                        </div>
                        
                        <div class="notes-container">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4><i class="fas fa-sticky-note"></i> ملاحظات خاصة</h4>
                                <button class="action-btn edit" id="editNotesBtn">
                                    <i class="fas fa-edit"></i> تعديل
                                </button>
                            </div>
                            <p id="memberNotesText">هذا العضو يفضل الاتصال به بعد الساعة 8 مساءً. لديه طفل يعاني من حساسية تجاه بعض الأطعمة.</p>
                            <textarea id="memberNotesEdit" style="display: none; width: 100%; height: 100px; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 16px;"></textarea>
                            <div id="notesActions" style="display: none; margin-top: 10px;">
                                <button id="saveNotesBtn" class="action-btn">
                                    <i class="fas fa-save"></i> حفظ
                                </button>
                                <button id="cancelNotesBtn" class="action-btn" style="background: var(--gray);">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </div>
                        
                        <h3 style="margin: 20px 0 15px; color: var(--primary);">
                            <i class="fas fa-history"></i> تاريخ التواصل
                        </h3>
                        
                        <div class="activity-log" id="memberActivityLog">
                            <div class="activity-item">
                                <div>
                                    <strong>بولا نادر</strong> - اتصال هاتفي
                                </div>
                                <div class="activity-time">28/06/2025 10:30</div>
                            </div>
                            <div class="activity-item">
                                <div>
                                    <strong>مريم عادل</strong> - رسالة واتساب
                                </div>
                                <div class="activity-time">27/06/2025 15:45</div>
                            </div>
                            <div class="activity-item">
                                <div>
                                    <strong>مينا رامي</strong> - زيارة منزلية
                                </div>
                                <div class="activity-time">26/06/2025 09:20</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- صفحة تسجيل الحضور -->
            <div id="attendancePage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-calendar-check"></i>
                    تسجيل الحضور
                </h2>
                
                <div class="form-container">
                    <div class="attendance-date">
                        <i class="fas fa-calendar-day"></i>
                        <label for="attendanceDate">تاريخ اليوم:</label>
                        <input type="date" id="attendanceDate" value="">
                    </div>
                    
                    <h3 style="margin: 20px 0 15px; color: var(--primary);">
                        <i class="fas fa-users"></i> قائمة الأعضاء
                    </h3>
                    
                    <div id="attendanceList" class="attendance-grid">
                        <!-- سيتم ملؤه ديناميكيًا -->
                    </div>
                    
                    <div class="attendance-actions">
                        <button id="saveAttendanceBtn">
                            <i class="fas fa-save"></i> حفظ الحضور
                        </button>
                        <button id="cancelAttendanceBtn" style="background: var(--gray);">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- صفحة إدارة الخدام -->
            <div id="servantsPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-user-friends"></i>
                    إدارة الخدام
                </h2>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> معلومات هامة</h3>
                    <p>في هذه الصفحة يمكنك إضافة وإدارة الخدام المسؤولين عن التواصل مع الأعضاء. سيحصل كل خادم على:</p>
                    <ul>
                        <li>رقم هاتف وكلمة مرور للدخول إلى التطبيق</li>
                        <li>إمكانية تسجيل أنشطة التواصل مع الأعضاء</li>
                        <li>تقرير أسبوعي وشهري بأنشطتهم</li>
                    </ul>
                </div>
                
                <button id="addServantBtn" style="margin-bottom: 20px;">
                    <i class="fas fa-user-plus"></i> إضافة خادم جديد
                </button>
                
                <div id="servantsList">
                    <div class="servant-card">
                        <h3><i class="fas fa-user"></i> بولا نادر</h3>
                        <div class="member-info">
                            <i class="fas fa-phone"></i>
                            <span><strong>رقم الهاتف:</strong> 01234567891</span>
                        </div>
                        <div class="servant-actions">
                            <button class="action-btn edit-servant" data-id="1">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="action-btn delete delete-servant" data-id="1">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                            <button class="action-btn reports-servant" data-id="1">
                                <i class="fas fa-chart-bar"></i> التقارير
                            </button>
                        </div>
                    </div>
                    
                    <div class="servant-card">
                        <h3><i class="fas fa-user"></i> مينا رامي</h3>
                        <div class="member-info">
                            <i class="fas fa-phone"></i>
                            <span><strong>رقم الهاتف:</strong> 01234567892</span>
                        </div>
                        <div class="servant-actions">
                            <button class="action-btn edit-servant" data-id="2">
                                <i class="fas fa-edit"></i> تعديل
                            </button>
                            <button class="action-btn delete delete-servant" data-id="2">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                            <button class="action-btn reports-servant" data-id="2">
                                <i class="fas fa-chart-bar"></i> التقارير
                            </button>
                        </div>
                    </div>
                </div>
                
                <h3 class="section-title" style="margin-top: 30px;">
                    <i class="fas fa-history"></i>
                    أنشطة الخدام الأخيرة
                </h3>
                
                <div class="report-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الخادم</th>
                                <th>العضو</th>
                                <th>نوع النشاط</th>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>بولا نادر</td>
                                <td>ماريان حنا</td>
                                <td>اتصال هاتفي</td>
                                <td>28/06/2025</td>
                                <td>10:30 صباحاً</td>
                            </tr>
                            <tr>
                                <td>مينا رامي</td>
                                <td>بطرس سمير</td>
                                <td>زيارة منزلية</td>
                                <td>27/06/2025</td>
                                <td>03:15 مساءً</td>
                            </tr>
                            <tr>
                                <td>مريم عادل</td>
                                <td>سميرة فوزي</td>
                                <td>رسالة واتساب</td>
                                <td>26/06/2025</td>
                                <td>09:45 صباحاً</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- صفحة إعدادات المسؤول -->
            <div id="adminSettingsPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-cog"></i>
                    إعدادات المسؤول
                </h2>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> معلومات هامة</h3>
                    <p>في هذه الصفحة يمكنك تغيير كلمة مرور المسؤول وإدارة إعدادات النظام.</p>
                </div>
                
                <div class="report-container">
                    <h3 class="section-title">
                        <i class="fas fa-lock"></i>
                        تغيير كلمة المرور
                    </h3>
                    
                    <div class="input-group">
                        <label for="currentAdminPassword">كلمة المرور الحالية</label>
                        <input type="password" id="currentAdminPassword" placeholder="أدخل كلمة المرور الحالية">
                    </div>
                    
                    <div class="input-group">
                        <label for="newAdminPassword">كلمة المرور الجديدة</label>
                        <input type="password" id="newAdminPassword" placeholder="أدخل كلمة المرور الجديدة">
                    </div>
                    
                    <div class="input-group">
                        <label for="confirmAdminPassword">تأكيد كلمة المرور الجديدة</label>
                        <input type="password" id="confirmAdminPassword" placeholder="تأكيد كلمة المرور الجديدة">
                    </div>
                    
                    <div class="admin-actions">
                        <button id="changePasswordBtn">
                            <i class="fas fa-key"></i> تغيير كلمة المرور
                        </button>
                    </div>
                </div>
                
                <div class="report-container">
                    <h3 class="section-title">
                        <i class="fas fa-database"></i>
                        إدارة البيانات
                    </h3>
                    
                    <div class="admin-actions">
                        <button id="backupDataBtn">
                            <i class="fas fa-download"></i> نسخ احتياطي للبيانات
                        </button>
                        <button id="restoreDataBtn">
                            <i class="fas fa-upload"></i> استعادة البيانات
                        </button>
                        <button id="resetDataBtn" style="background: var(--error);">
                            <i class="fas fa-trash"></i> إعادة ضبط البيانات
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- صفحة التقارير -->
            <div id="reportsPage" class="page">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    تقارير الحضور والافتقاد
                </h2>
                
                <div class="report-filters">
                    <div class="filter-group">
                        <label for="reportType">نوع التقرير</label>
                        <select id="reportType">
                            <option value="attendance">تقرير الحضور</option>
                            <option value="visitation">تقرير الافتقاد</option>
                            <option value="servant">تقرير الخدام</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="reportPeriod">الفترة الزمنية</label>
                        <select id="reportPeriod">
                            <option value="weekly">أسبوعي</option>
                            <option value="monthly">شهري</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="servantSelect">اختر الخادم</label>
                        <select id="servantSelect">
                            <option value="all">جميع الخدام</option>
                            <option value="1">بولا نادر</option>
                            <option value="2">مينا رامي</option>
                            <option value="3">مريم عادل</option>
                        </select>
                    </div>
                </div>
                
                <button id="generateReportBtn" style="margin-bottom: 30px;">
                    <i class="fas fa-cogs"></i> توليد التقرير
                </button>
                
                <div id="reportResults">
                    <div class="report-container">
                        <div class="report-header">
                            <h2 class="report-title">تقرير أنشطة الخدام الأسبوعي</h2>
                            <div class="report-actions">
                                <button class="export-btn">
                                    <i class="fas fa-file-pdf"></i> تصدير PDF
                                </button>
                                <button class="export-btn">
                                    <i class="fas fa-file-excel"></i> تصدير Excel
                                </button>
                            </div>
                        </div>
                        
                        <div class="report-summary">
                            <div class="summary-card">
                                <h3>إجمالي الأنشطة</h3>
                                <div class="summary-value">24</div>
                            </div>
                            <div class="summary-card">
                                <h3>أكثر خادم نشاطاً</h3>
                                <div class="summary-value">بولا نادر</div>
                            </div>
                            <div class="summary-card">
                                <h3>عدد المكالمات</h3>
                                <div class="summary-value">12</div>
                            </div>
                            <div class="summary-card">
                                <h3>عدد الزيارات</h3>
                                <div class="summary-value">8</div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="servantChart"></canvas>
                        </div>
                        
                        <h3 class="section-title">
                            <i class="fas fa-table"></i>
                            تفاصيل الأنشطة
                        </h3>
                        
                        <div class="report-table">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>اسم الخادم</th>
                                        <th>عدد المكالمات</th>
                                        <th>عدد الزيارات</th>
                                        <th>عدد الرسائل</th>
                                        <th>إجمالي الأنشطة</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>بولا نادر</td>
                                        <td>8</td>
                                        <td>3</td>
                                        <td>5</td>
                                        <td>16</td>
                                    </tr>
                                    <tr>
                                        <td>مينا رامي</td>
                                        <td>5</td>
                                        <td>6</td>
                                        <td>2</td>
                                        <td>13</td>
                                    </tr>
                                    <tr>
                                        <td>مريم عادل</td>
                                        <td>4</td>
                                        <td>2</td>
                                        <td>7</td>
                                        <td>13</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- زر إضافة عضو جديد -->
        <button class="add-btn" id="addMemberBtn" title="إضافة عضو جديد">
            <i class="fas fa-plus"></i>
        </button>
        
        <!-- عنصر خفي لاستيراد ملفات Excel -->
        <input type="file" id="excelFileInput" style="display: none;" accept=".xlsx, .xls">
    </div>

    <script>
        // كود الدخول
        let ADMIN_PASSWORD = "BABA123";
        
        // بيانات الخدام
        let servants = [
            { id: 1, name: "بولا نادر", phone: "01234567891", password: "123456" },
            { id: 2, name: "مينا رامي", phone: "01234567892", password: "123456" },
            { id: 3, name: "مريم عادل", phone: "01234567893", password: "123456" }
        ];
        
        // تخزين بيانات الأعضاء
        let members = [];
        let currentMemberId = null;
        let activities = [];
        let currentUser = null;
        let currentEditingNotes = false;
        
        // عناصر الصفحة
        const loginPage = document.getElementById('loginPage');
        const app = document.getElementById('app');
        const loginBtn = document.getElementById('loginBtn');
        const inviteCodeInput = document.getElementById('inviteCode');
        const codeError = document.getElementById('codeError');
        const logoutBtn = document.getElementById('logoutBtn');
        const addMemberBtn = document.getElementById('addMemberBtn');
        const homeBtn = document.getElementById('homeBtn');
        const membersBtn = document.getElementById('membersBtn');
        const attendanceBtn = document.getElementById('attendanceBtn');
        const reportsBtn = document.getElementById('reportsBtn');
        const servantsBtn = document.getElementById('servantsBtn');
        const adminSettingsBtn = document.getElementById('adminSettingsBtn');
        const homePage = document.getElementById('homePage');
        const membersPage = document.getElementById('membersPage');
        const addMemberPage = document.getElementById('addMemberPage');
        const memberDetailsPage = document.getElementById('memberDetailsPage');
        const attendancePage = document.getElementById('attendancePage');
        const servantsPage = document.getElementById('servantsPage');
        const adminSettingsPage = document.getElementById('adminSettingsPage');
        const reportsPage = document.getElementById('reportsPage');
        const membersList = document.getElementById('membersList');
        const emptyMembers = document.getElementById('emptyMembers');
        const deleteConfirmation = document.getElementById('deleteConfirmation');
        const memberToDelete = document.getElementById('memberToDelete');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const deleteMemberBtn = document.getElementById('deleteMemberBtn');
        const saveMemberBtn = document.getElementById('saveMemberBtn');
        const cancelAddMember = document.getElementById('cancelAddMember');
        const addFirstMember = document.getElementById('addFirstMember');
        const saveAttendanceBtn = document.getElementById('saveAttendanceBtn');
        const cancelAttendanceBtn = document.getElementById('cancelAttendanceBtn');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const userTypeSelect = document.getElementById('userType');
        const codeLabel = document.getElementById('codeLabel');
        const servantFields = document.getElementById('servantFields');
        const servantPhoneInput = document.getElementById('servantPhone');
        const addServantBtn = document.getElementById('addServantBtn');
        const loggedInUser = document.getElementById('loggedInUser');
        const userRole = document.getElementById('userRole');
        const deleteServantConfirmation = document.getElementById('deleteServantConfirmation');
        const servantToDelete = document.getElementById('servantToDelete');
        const confirmServantDeleteBtn = document.getElementById('confirmServantDeleteBtn');
        const cancelServantDeleteBtn = document.getElementById('cancelServantDeleteBtn');
        const servantFormModal = document.getElementById('servantFormModal');
        const servantFormTitle = document.getElementById('servantFormTitle');
        const saveServantBtn = document.getElementById('saveServantBtn');
        const cancelServantBtn = document.getElementById('cancelServantBtn');
        const servantFormError = document.getElementById('servantFormError');
        const importExcelBtn = document.getElementById('importExcelBtn');
        const excelFileInput = document.getElementById('excelFileInput');
        const editNotesBtn = document.getElementById('editNotesBtn');
        const memberNotesText = document.getElementById('memberNotesText');
        const memberNotesEdit = document.getElementById('memberNotesEdit');
        const notesActions = document.getElementById('notesActions');
        const saveNotesBtn = document.getElementById('saveNotesBtn');
        const cancelNotesBtn = document.getElementById('cancelNotesBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const adminSettingsModal = document.getElementById('adminSettingsModal');
        const saveAdminPasswordBtn = document.getElementById('saveAdminPasswordBtn');
        const cancelAdminSettingsBtn = document.getElementById('cancelAdminSettingsBtn');
        const adminSettingsError = document.getElementById('adminSettingsError');
        
        // عند تغيير نوع المستخدم
        userTypeSelect.addEventListener('change', function() {
            if(this.value === 'servant') {
                codeLabel.textContent = "كلمة المرور";
                inviteCodeInput.placeholder = "أدخل كلمة المرور";
                servantFields.style.display = 'block';
            } else {
                codeLabel.textContent = "كود الدخول";
                inviteCodeInput.placeholder = "أدخل كود الدخول";
                servantFields.style.display = 'none';
            }
        });
        
        // الدخول إلى التطبيق
        loginBtn.addEventListener('click', function() {
            const userType = userTypeSelect.value;
            const enteredCode = inviteCodeInput.value.trim();
            const servantPhone = servantPhoneInput.value.trim();
            
            if(userType === 'admin') {
                if(enteredCode === ADMIN_PASSWORD) {
                    currentUser = { 
                        type: 'admin',
                        name: 'المسؤول'
                    };
                    loginPage.style.display = 'none';
                    app.style.display = 'block';
                    codeError.style.display = 'none';
                    loadMembers();
                    updateStatistics();
                    updateUserWelcome();
                    
                    // إظهار أزرار المسؤول فقط
                    servantsBtn.style.display = 'flex';
                    adminSettingsBtn.style.display = 'flex';
                    deleteMemberBtn.style.display = 'block';
                } else {
                    showError();
                }
            } else if(userType === 'servant') {
                const servant = servants.find(s => 
                    s.phone === servantPhone && s.password === enteredCode
                );
                
                if(servant) {
                    currentUser = {
                        type: 'servant',
                        id: servant.id,
                        name: servant.name
                    };
                    loginPage.style.display = 'none';
                    app.style.display = 'block';
                    codeError.style.display = 'none';
                    loadMembers();
                    updateStatistics();
                    updateUserWelcome();
                    
                    // إخفاء أزرار المسؤول
                    servantsBtn.style.display = 'none';
                    adminSettingsBtn.style.display = 'none';
                    deleteMemberBtn.style.display = 'none';
                } else {
                    showError();
                }
            }
            
            function showError() {
                codeError.style.display = 'block';
                inviteCodeInput.classList.add('error');
                inviteCodeInput.focus();
                
                inviteCodeInput.animate([
                    { transform: 'translateX(0)' },
                    { transform: 'translateX(-10px)' },
                    { transform: 'translateX(10px)' },
                    { transform: 'translateX(0)' }
                ], {
                    duration: 300,
                    iterations: 2
                });
            }
        });
        
        // تحديث رسالة الترحيب
        function updateUserWelcome() {
            if(currentUser) {
                loggedInUser.textContent = `مرحباً ${currentUser.name}!`;
                userRole.textContent = `(${currentUser.type === 'admin' ? 'المسؤول' : 'خادم'})`;
            }
        }
        
        // تسجيل الخروج
        logoutBtn.addEventListener('click', function() {
            app.style.display = 'none';
            loginPage.style.display = 'flex';
            inviteCodeInput.value = '';
            inviteCodeInput.focus();
            alert('تم تسجيل الخروج بنجاح.');
        });
        
        // تحميل الأعضاء وعرضهم
        function loadMembers() {
            membersList.innerHTML = '';
            
            if(members.length === 0) {
                emptyMembers.style.display = 'block';
                return;
            }
            
            emptyMembers.style.display = 'none';
            
            members.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = 'member-card';
                memberCard.innerHTML = `
                    <div class="member-header">
                        <div class="member-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div class="member-name">${member.fullName}</div>
                            <div class="member-type">${member.memberType}</div>
                        </div>
                    </div>
                    <div class="member-body">
                        <div class="member-info">
                            <i class="fas fa-phone"></i>
                            <span>${member.phone}</span>
                        </div>
                        <div class="member-info">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${member.address.substring(0, 20)}${member.address.length > 20 ? '...' : ''}</span>
                        </div>
                        
                        <div class="notes-container" style="margin-top: 15px;">
                            <h4><i class="fas fa-sticky-note"></i> ملاحظات</h4>
                            <p>${member.notes.substring(0, 50)}${member.notes.length > 50 ? '...' : ''}</p>
                        </div>
                        
                        <div class="member-actions">
                            <button class="action-btn view-member" data-id="${member.id}">
                                <i class="fas fa-eye"></i> تفاصيل
                            </button>
                            <button class="action-btn call" data-phone="${member.phone}">
                                <i class="fas fa-phone"></i> اتصال
                            </button>
                            <button class="action-btn whatsapp" data-phone="${member.phone}">
                                <i class="fab fa-whatsapp"></i> واتساب
                            </button>
                        </div>
                    </div>
                `;
                membersList.appendChild(memberCard);
            });
            
            // إضافة مستمعات الأحداث للأزرار الجديدة
            document.querySelectorAll('.view-member').forEach(btn => {
                btn.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    showMemberDetails(memberId);
                });
            });
            
            document.querySelectorAll('.call').forEach(btn => {
                btn.addEventListener('click', function() {
                    const phone = this.getAttribute('data-phone');
                    logActivity('call', phone);
                    window.open(`tel:${phone}`);
                });
            });
            
            document.querySelectorAll('.whatsapp').forEach(btn => {
                btn.addEventListener('click', function() {
                    const phone = this.getAttribute('data-phone');
                    logActivity('whatsapp', phone);
                    window.open(`https://wa.me/${phone}`);
                });
            });
        }
        
        // تسجيل النشاط
        function logActivity(type, phone) {
            if(currentUser && currentUser.type === 'servant') {
                const member = members.find(m => m.phone === phone);
                if(member) {
                    const action = type === 'call' ? 'اتصال هاتفي' : 'رسالة واتساب';
                    const activity = {
                        memberId: member.id,
                        memberName: member.fullName,
                        servantId: currentUser.id,
                        servantName: currentUser.name,
                        action: action,
                        time: new Date().toLocaleString('ar-EG')
                    };
                    
                    if(!member.activities) member.activities = [];
                    member.activities.push(activity);
                    
                    // إظهار رسالة تأكيد
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success';
                    alert.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>تم تسجيل النشاط!</strong>
                            <p>تم تسجيل ${action} مع ${member.fullName} بنجاح.</p>
                        </div>
                    `;
                    document.querySelector('.app-content').prepend(alert);
                    
                    setTimeout(() => {
                        alert.remove();
                    }, 3000);
                }
            }
        }
        
        // عرض تفاصيل العضو
        function showMemberDetails(memberId) {
            const member = members.find(m => m.id == memberId);
            if(member) {
                document.getElementById('memberTitle').innerHTML = `
                    <h2 style="color: var(--primary);">${member.fullName} <small style="font-size: 16px; background: var(--light); padding: 3px 10px; border-radius: 20px;">${member.memberType}</small></h2>
                `;
                
                document.getElementById('memberNotesText').textContent = member.notes || 'لا توجد ملاحظات';
                
                // إنشاء QR Code
                const qrContainer = document.getElementById('memberQrcode');
                qrContainer.innerHTML = '';
                const qrCode = new QRCode(qrContainer, {
                    text: `MEMBER:${member.id}`,
                    width: 150,
                    height: 150
                });
                
                // عرض أنشطة العضو
                const activityLog = document.getElementById('memberActivityLog');
                activityLog.innerHTML = '';
                
                if(member.activities && member.activities.length > 0) {
                    member.activities.forEach(activity => {
                        const activityItem = document.createElement('div');
                        activityItem.className = 'activity-item';
                        activityItem.innerHTML = `
                            <div>
                                <strong>${activity.servantName}</strong> - ${activity.action}
                            </div>
                            <div class="activity-time">${activity.time}</div>
                        `;
                        activityLog.appendChild(activityItem);
                    });
                } else {
                    activityLog.innerHTML = '<p>لا توجد أنشطة مسجلة لهذا العضو</p>';
                }
                
                // إعداد ملاحظات العضو للتعديل
                currentMemberId = memberId;
                currentEditingNotes = false;
                memberNotesText.style.display = 'block';
                memberNotesEdit.style.display = 'none';
                notesActions.style.display = 'none';
                
                showPage(memberDetailsPage);
            }
        }
        
        // تعديل ملاحظات العضو
        editNotesBtn.addEventListener('click', function() {
            const member = members.find(m => m.id == currentMemberId);
            if(member) {
                currentEditingNotes = true;
                memberNotesEdit.value = member.notes || '';
                memberNotesText.style.display = 'none';
                memberNotesEdit.style.display = 'block';
                notesActions.style.display = 'flex';
            }
        });
        
        saveNotesBtn.addEventListener('click', function() {
            const member = members.find(m => m.id == currentMemberId);
            if(member) {
                member.notes = memberNotesEdit.value;
                memberNotesText.textContent = member.notes || 'لا توجد ملاحظات';
                
                // العودة لوضع العرض
                currentEditingNotes = false;
                memberNotesText.style.display = 'block';
                memberNotesEdit.style.display = 'none';
                notesActions.style.display = 'none';
                
                // تحديث قائمة الأعضاء
                loadMembers();
                
                alert('تم تحديث الملاحظات بنجاح');
            }
        });
        
        cancelNotesBtn.addEventListener('click', function() {
            currentEditingNotes = false;
            memberNotesText.style.display = 'block';
            memberNotesEdit.style.display = 'none';
            notesActions.style.display = 'none';
        });
        
        // إضافة عضو جديد
        addMemberBtn.addEventListener('click', function() {
            showPage(addMemberPage);
        });
        
        // إلغاء إضافة عضو
        cancelAddMember.addEventListener('click', function() {
            showPage(membersPage);
        });
        
        // حفظ العضو الجديد
        saveMemberBtn.addEventListener('click', function() {
            const fullName = document.getElementById('fullName').value;
            if(!fullName) {
                alert('الرجاء إدخال الاسم الكامل');
                return;
            }
            
            const newMember = {
                id: Date.now(),
                fullName: fullName,
                memberType: document.getElementById('memberType').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                childrenCount: document.getElementById('childrenCount').value,
                childrenAges: document.getElementById('childrenAges').value,
                notes: document.getElementById('notes').value,
                barcode: Math.random().toString(36).substr(2, 9).toUpperCase()
            };
            
            members.push(newMember);
            loadMembers();
            showPage(membersPage);
            alert(`تم إضافة العضو ${fullName} بنجاح`);
        });
        
        // تحديث الإحصائيات
        function updateStatistics() {
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('totalServants').textContent = servants.length;
        }
        
        // التنقل بين الصفحات
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            page.style.display = 'block';
        }
        
        // أحداث التنقل
        homeBtn.addEventListener('click', () => showPage(homePage));
        membersBtn.addEventListener('click', () => showPage(membersPage));
        attendanceBtn.addEventListener('click', () => {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = formattedDate;
            showPage(attendancePage);
        });
        servantsBtn.addEventListener('click', () => {
            renderServants();
            showPage(servantsPage);
        });
        adminSettingsBtn.addEventListener('click', () => showPage(adminSettingsPage));
        reportsBtn.addEventListener('click', () => showPage(reportsPage));
        
        // إضافة أول عضو
        addFirstMember.addEventListener('click', () => showPage(addMemberPage));
        
        // فتح نموذج الخادم
        function openServantForm(servantId = null) {
            servantFormError.textContent = '';
            servantFormError.style.display = 'none';
            
            if(servantId) {
                // وضع التعديل
                const servant = servants.find(s => s.id == servantId);
                if(servant) {
                    servantFormTitle.innerHTML = '<i class="fas fa-user-edit"></i> تعديل بيانات الخادم';
                    document.getElementById('servantName').value = servant.name;
                    document.getElementById('servantPhoneForm').value = servant.phone;
                    document.getElementById('servantPassword').value = '';
                    document.getElementById('servantConfirmPassword').value = '';
                    servantFormModal.setAttribute('data-id', servantId);
                }
            } else {
                // وضع الإضافة
                servantFormTitle.innerHTML = '<i class="fas fa-user-plus"></i> إضافة خادم جديد';
                document.getElementById('servantName').value = '';
                document.getElementById('servantPhoneForm').value = '';
                document.getElementById('servantPassword').value = '';
                document.getElementById('servantConfirmPassword').value = '';
                servantFormModal.removeAttribute('data-id');
            }
            
            servantFormModal.style.display = 'flex';
        }
        
        // حفظ بيانات الخادم
        saveServantBtn.addEventListener('click', function() {
            const name = document.getElementById('servantName').value.trim();
            const phone = document.getElementById('servantPhoneForm').value.trim();
            const password = document.getElementById('servantPassword').value;
            const confirmPassword = document.getElementById('servantConfirmPassword').value;
            const servantId = servantFormModal.getAttribute('data-id');
            
            // التحقق من البيانات
            if(!name || !phone || !password) {
                showServantError('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            if(password !== confirmPassword) {
                showServantError('كلمة المرور وتأكيدها غير متطابقين');
                return;
            }
            
            if(servantId) {
                // تحديث الخادم الموجود
                const index = servants.findIndex(s => s.id == servantId);
                if(index !== -1) {
                    servants[index].name = name;
                    servants[index].phone = phone;
                    servants[index].password = password;
                }
            } else {
                // إضافة خادم جديد
                const newServant = {
                    id: Date.now(),
                    name: name,
                    phone: phone,
                    password: password
                };
                servants.push(newServant);
            }
            
            // إعادة عرض الخدام
            renderServants();
            servantFormModal.style.display = 'none';
            alert(`تم ${servantId ? 'تحديث' : 'إضافة'} الخادم بنجاح`);
        });
        
        // إظهار خطأ في نموذج الخادم
        function showServantError(message) {
            servantFormError.textContent = message;
            servantFormError.style.display = 'block';
        }
        
        // حذف الخادم
        confirmServantDeleteBtn.addEventListener('click', function() {
            const servantId = deleteServantConfirmation.getAttribute('data-id');
            if(servantId) {
                servants = servants.filter(s => s.id != servantId);
                renderServants();
                deleteServantConfirmation.style.display = 'none';
                alert('تم حذف الخادم بنجاح');
            }
        });
        
        // إلغاء حذف الخادم
        cancelServantDeleteBtn.addEventListener('click', function() {
            deleteServantConfirmation.style.display = 'none';
        });
        
        // إلغاء نموذج الخادم
        cancelServantBtn.addEventListener('click', function() {
            servantFormModal.style.display = 'none';
        });
        
        // عرض الخدام
        function renderServants() {
            const servantsList = document.getElementById('servantsList');
            servantsList.innerHTML = '';
            
            servants.forEach(servant => {
                const servantCard = document.createElement('div');
                servantCard.className = 'servant-card';
                servantCard.innerHTML = `
                    <h3><i class="fas fa-user"></i> ${servant.name}</h3>
                    <div class="member-info">
                        <i class="fas fa-phone"></i>
                        <span><strong>رقم الهاتف:</strong> ${servant.phone}</span>
                    </div>
                    <div class="servant-actions">
                        <button class="action-btn edit-servant" data-id="${servant.id}">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="action-btn delete delete-servant" data-id="${servant.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                        <button class="action-btn reports-servant" data-id="${servant.id}">
                            <i class="fas fa-chart-bar"></i> التقارير
                        </button>
                    </div>
                `;
                servantsList.appendChild(servantCard);
            });
            
            // إعداد الأزرار بعد العرض
            setupServantsPage();
        }
        
        // إعداد أزرار الخدام
        function setupServantsPage() {
            // إضافة مستمعات الأحداث لأزرار الخدام
            document.querySelectorAll('.edit-servant').forEach(btn => {
                btn.addEventListener('click', function() {
                    const servantId = this.getAttribute('data-id');
                    openServantForm(servantId);
                });
            });
            
            document.querySelectorAll('.delete-servant').forEach(btn => {
                btn.addEventListener('click', function() {
                    const servantId = this.getAttribute('data-id');
                    const servant = servants.find(s => s.id == servantId);
                    if(servant) {
                        servantToDelete.textContent = servant.name;
                        deleteServantConfirmation.style.display = 'flex';
                        deleteServantConfirmation.setAttribute('data-id', servantId);
                    }
                });
            });
            
            document.querySelectorAll('.reports-servant').forEach(btn => {
                btn.addEventListener('click', function() {
                    const servantId = this.getAttribute('data-id');
                    alert(`سيتم عرض تقارير الخادم (ID: ${servantId}) - هذه الميزة قيد التطوير`);
                });
            });
        }
        
        // إضافة خادم جديد
        addServantBtn.addEventListener('click', function() {
            openServantForm();
        });
        
        // استيراد الأعضاء من Excel
        importExcelBtn.addEventListener('click', function() {
            excelFileInput.click();
        });
        
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // الحصول على أول ورقة عمل
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // تحويل إلى JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // معالجة البيانات
                    const importedMembers = jsonData.map(row => ({
                        id: Date.now() + Math.floor(Math.random() * 1000), // ID فريد
                        fullName: row['الاسم الكامل'] || '',
                        memberType: row['النوع'] || 'بابا',
                        phone: row['الهاتف'] || '',
                        address: row['العنوان'] || '',
                        childrenCount: row['عدد الأطفال'] || 0,
                        childrenAges: row['أعمار الأطفال'] || '',
                        notes: row['ملاحظات'] || '',
                        barcode: Math.random().toString(36).substr(2, 9).toUpperCase()
                    }));
                    
                    // إضافة للأعضاء
                    members = members.concat(importedMembers);
                    loadMembers();
                    updateStatistics();
                    
                    alert(`تم استيراد ${importedMembers.length} عضو بنجاح`);
                } catch (error) {
                    console.error('Error importing Excel:', error);
                    alert('حدث خطأ أثناء استيراد الملف. يرجى التأكد من صيغة الملف.');
                }
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        // تغيير كلمة مرور المسؤول
        changePasswordBtn.addEventListener('click', function() {
            adminSettingsModal.style.display = 'flex';
        });
        
        saveAdminPasswordBtn.addEventListener('click', function() {
            const currentPassword = document.getElementById('currentAdminPassword').value;
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if(currentPassword !== ADMIN_PASSWORD) {
                adminSettingsError.textContent = 'كلمة المرور الحالية غير صحيحة';
                adminSettingsError.style.display = 'block';
                return;
            }
            
            if(newPassword !== confirmPassword) {
                adminSettingsError.textContent = 'كلمة المرور الجديدة وتأكيدها غير متطابقين';
                adminSettingsError.style.display = 'block';
                return;
            }
            
            ADMIN_PASSWORD = newPassword;
            adminSettingsModal.style.display = 'none';
            alert('تم تغيير كلمة مرور المسؤول بنجاح');
        });
        
        cancelAdminSettingsBtn.addEventListener('click', function() {
            adminSettingsModal.style.display = 'none';
        });
        
        // عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = formattedDate;
            
            // إنشاء رسم بياني للخدام
            setTimeout(() => {
                const servantCtx = document.getElementById('servantChart').getContext('2d');
                new Chart(servantCtx, {
                    type: 'bar',
                    data: {
                        labels: ['بولا نادر', 'مينا رامي', 'مريم عادل'],
                        datasets: [{
                            label: 'عدد الأنشطة',
                            data: [16, 13, 13],
                            backgroundColor: 'rgba(44, 110, 73, 0.7)',
                            borderColor: 'rgba(44, 110, 73, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 2
                                }
                            }
                        }
                    }
                });
            }, 500);
        });
    </script>
</body>
</html>
